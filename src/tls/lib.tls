;; Library functions

;; TODO: applying (∘ inc inc inc) produces error
(= ∘ (:fn f (:fn g (:fn x (f (g x))))))

(= inc (:fn x (+ x 1)))
(= dec (:fn x (- x 1)))

;; TODO: change the name to (:name "..")
(= range
 (∪ (:fn (∈ a Int)
         (∪ (:fn a (:seq))
            (:fn (∈ b Int)
                 (:cons a (range (inc a) b))
                 (< a b))))
    (:fn (∈ c Char)
         (∪ (:fn c "")
            (:fn (∈ d Char)
                 (:cons c (range (intChar (inc a)) d))
                 (= a (charInt c)) (= b (charInt d)) (< a b))))))

(= map
   (:fn f
        (∪ (:fn (:seq) (:seq))
           (:fn (:cons x xs) (:cons (f x) (map f xs))))))

;; TODO: implement multiple guards, then rewrite filter and remove to use them

(= filter
   (:fn S
        (∪ (:fn (:seq) (:seq))
           (:fn (:cons x xs) (:cons x (filter S xs))
                (∈ x S))
           (:fn (:cons _ xs) (filter S xs)))))

(= remove
   (:fn S
        (∪ (:fn (:seq) (:seq))
           (:fn (:cons (∈ _ S) xs) (remove S xs))
           (:fn (:cons x xs) (:cons x (remove S xs))))))

(= identity
   (:fn x x))

;; TODO: make sure <then> and <else> are lazily evaluated.
;; TODO: rewrite with multiple guards.
(= if
   (:fn cond
        (:fn then
             (:fn else
                  ((∪ (:fn _ then cond)
                      (:fn _ else))
                   :emptyfn)))))
